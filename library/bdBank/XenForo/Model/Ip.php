<?php

class bdBank_XenForo_Model_Ip extends XFCP_bdBank_XenForo_Model_Ip
{
    public function logIp($userId, $contentType, $contentId, $action, $ipAddress = null, $date = null)
    {
        if ($userId > 0
            && $action === 'login'
        ) {
            $bank = bdBank_Model_Bank::getInstance();
            $bonusType = 'login';
            $point = $bank->getActionBonus($bonusType, XenForo_Application::$time);
            if ($point != 0) {
                $comment = $bank->comment($bonusType, floor(XenForo_Application::$time / 86400));
                $reverseResult = $bank->reverseSystemTransactionByComment($comment, $point);
                if (count($reverseResult['skipped']) === 0) {
                    $bank->personal()->give($userId, $point, $comment);
                }
            }
        }

        return parent::logIp(
            $userId,
            $contentType,
            $contentId,
            $action,
            $ipAddress,
            $date
        ); // TODO: Change the autogenerated stub
    }
}
